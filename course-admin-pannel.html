<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Add/Delete Users from Courses</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f9;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: left;
      min-height: 100vh;
    }

    .container {
      background-color: #ffffff;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      border-radius: 10px;
      padding: 20px;
      max-width: 90%;
      margin: 20px;
    }

    h1, h2 {
      color: #333;
      text-align: center;
    }

    form {
      display: flex;
      flex-direction: column;
      align-items: left;
    }

    label {
      margin: 10px 0 5px;
      font-weight: bold;
    }

    input[type="text"],
    select {
      padding: 10px;
      margin: 5px 0;
      width: 100%;
      max-width: 300px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
    }

    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 10px 0;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }

    button:hover {
      background-color: #45a049;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }

    table, th, td {
      border: 1px solid rgb(133, 133, 133);
    }

    th, td {
      padding: 12px;
      text-align: left;
    }

    th {
      background-color: #4CAF50;
      color: white;
    }

    tr:nth-child(even) {
      background-color: #f2f2f2;
    }

    .details, .delete, .copy {
      background-color: #f44336;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 14px;
    }

    .details:hover, .delete:hover, .copy:hover {
      background-color: #e53935;
    }

    @media (max-width: 768px) {
      form, table {
        width: 100%;
        max-width: 100%;
      }

      input[type="text"],
      select {
        max-width: 100%;
      }

      .container {
        padding: 15px;
      }
    }
  </style>
</head>

<body>
  <div class="container">

    <div class="course-section">

      <form id="courseForm">
        <label for="courseId">Course ID:</label>
        <div class="select-wrapper">
          <select id="courseId" name="courseId" required>
            <option value="select-a-course" selected>Select a course</option>



            <option value="class-10-english-dristhi">Class 10 English (Dristhi)</option>
            <option value="class-10-economics-dristhi">Class 10 Economics (Dristhi)</option>
            <option value="class-10-math-dristhi">Class 10 Math (Dristhi)</option>
            <option value="class-10-science-dristhi">Class 10 Science (Dristhi)</option>
            <option value="class-10-optional-math-dristhi">Class 10 Optional Math (Dristhi)</option>

            

            <option value="class-12-math">Class 12 Math</option>
            <option value="class-12-social">Class 12 Social</option>
            <option value="class-12-account">Class 12 Account</option>
            <option value="class-12-economics">Class 12 Economics</option>
            <option value="class-12-english">Class 12 English</option>
            <option value="class-12-physics">Class 12 Physics</option>
            <option value="class-12-biology">Class 12 Biology</option>
            <option value="class-12-chemistry">Class 12 Chemistry</option>
            


            <!-- <option value="ctevt-first-year-physics-m">CTEVT Physics (Medical) </option>
            <option value="ctevt-first-year-chemistry-m">CTEVT Chemistry (Medical) </option>
            <option value="ctevt-first-year-math-m">CTEVT Mathematics (Medical) </option>
            <option value="ctevt-first-year-zoology-m">CTEVT Zoology (Medical) </option>
            <option value="ctevt-first-year-botany-m">CTEVT Botany (Medical) </option> 
            
            <option value="class-11-english">Class 11 English</option>
            <option value="class-11-physics">Class 11 Physics</option>
            <option value="class-11-chemistry">Class 11 Chemistry</option>
            <option value="class-11-math">Class 11 Math</option>
            <option value="class-11-biology">Class 11 Biology</option>
            <option value="class-11-account">Class 11 Account</option>
            <option value="class-11-economics">Class 11 Economics</option>
            
         <option value="class-10-english">Class 10 English</option>
            <option value="class-10-economics">Class 10 Economics</option>
            <option value="class-10-math">Class 10 Math</option>
            <option value="class-10-science">Class 10 Science</option>
            <option value="class-10-optional-math">Class 10 Optional Math</option>s

             <option value="class-10-english-sampurna">Class 10 English (Sampurna)</option>
            <option value="class-10-economics-sampurna">Class 10 Economics (Sampurna)</option>
            <option value="class-10-math-sampurna">Class 10 Math (Sampurna)</option>
            <option value="class-10-science-sampurna">Class 10 Science (Sampurna)</option>
            <option value="class-10-optional-math-sampurna">Class 10 Optional Math (Sampurna)</option>

          <option value="class-10-english-jyoti">Class 10 English (Jyoti)</option>
            <option value="class-10-economics-jyoti">Class 10 Economics (Jyoti)</option>
            <option value="class-10-math-jyoti">Class 10 Math (Jyoti)</option>
            <option value="class-10-science-jyoti">Class 10 Science (Jyoti)</option>
            <option value="class-10-optional-math-jyoti">Class 10 Optional Math (Jyoti)</option> --> 
          

            

          </select><br><br>
        </div>

        <script>
          // Function to handle change in the dropdown menu
          document.getElementById('courseId').addEventListener('change', function () {
            // Get the selected option value
            const selectedOption = this.value;

            // Set the value of the input field courseId
            document.getElementById('courseIdInput').value = selectedOption;
          });
        </script>
        <input type="text" id="courseIdInput" name="courseId" required>
        <br><br>
        <label for="addUsers">Email :</label>
        <input type="text" id="addUsers" name="addUsers" placeholder="Enter email addresses, separated by commas">

        <button type="submit">Add Course</button>
      </form>

      <br>

      <h2>Course Details</h2>
      <table id="courseTable">
        <thead>
          <tr>
            <th>Course</th>
            <th>Name</th>
            <th>Action</th>
            
            <th id="fullNameHeader" style="display: none;">Full Name</th>
            <th id="actionHeader" style="display: none;">Action</th>
            <th id="detailsHeader" style="display: none;">Details</th>
          </tr>
        </thead>
        <tbody>
          <!-- Course data will be dynamically inserted here -->
        </tbody>
      </table>

    
      <!-- Add a button for downloading Excel -->

    </div>

    <a target="_main" href="https://console.firebase.google.com/u/0/project/noteswift-login/authentication/users">Click here to
      delete users</a> <br>
      <button style="background-color: green;" id="downloadExcelBtn">Download as Excel file</button>
    <div style="display: none;" class="user-details">
      <h2>User Details</h2>
      <table id="userTable">
        <thead>
          <tr>
            <th>Full Name</th>
            <th>UID</th>
            <th>Email</th>
            <th>Class</th>
            <th>Contact Number</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <!-- User data will be dynamically inserted here -->
        </tbody>
      </table>
   
    </div>
  </div>
  <!-- Import Firebase SDK using script tags -->
  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>

  <script>
    // Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyBiVc598fJn7WmgGVivUvZyKRBNfrug75U",
      authDomain: "noteswift-login.firebaseapp.com",
      projectId: "noteswift-login",
      storageBucket: "noteswift-login.appspot.com",
      messagingSenderId: "227729152808",
      appId: "1:227729152808:web:445ffda231ae7baf8a4e1d",
      measurementId: "G-Y3GZ6HDWF4"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Reference to the 'users' node in the database
    const usersRef = database.ref('users');

    // Function to retrieve user data and populate the user table
    usersRef.on('value', function (snapshot) {
      const userTable = document.getElementById('userTable').getElementsByTagName('tbody')[0];
      userTable.innerHTML = ''; // Clear existing table rows

      snapshot.forEach(function (childSnapshot) {
        const userData = childSnapshot.val();
        const fullName = userData.fullName || '';
        const uid = childSnapshot.key || '';
        const email = userData.email || '';
        const className = userData.class || '';
        const contactNumber = userData.contactNumber || '';

        // Create a new table row and append user data
        const newRow = document.createElement('tr');
        newRow.innerHTML = `
          <td>${fullName}</td>
          <td>${uid}</td>
          <td>${email}</td>
          <td>${className}</td>
          <td>${contactNumber}</td>
          <td>
            <button class="copy" onclick="copyUid('${uid}')">Copy UID</button>
          </td>
        `;
        userTable.appendChild(newRow);
      });
    });

    // Function to copy UID to clipboard
    function copyUid(uid) {
      const el = document.createElement('textarea');
      el.value = uid;
      document.body.appendChild(el);
      el.select();
      document.execCommand('copy');
      document.body.removeChild(el);
      alert('UID copied to clipboard: ' + uid);
    }

    // Reference to the 'courses' node in the database
    const coursesRef = database.ref('courses');

    // Function to delete a user from a course
    function deleteUserFromCourse(courseId, uidToDelete) {
      coursesRef.child(courseId).child(uidToDelete).remove()
        .then(() => {
          alert("User deleted from course successfully!");
        })
        .catch(error => {
          console.error("Error deleting user from course: ", error);
          alert("Error deleting user from course. Please try again.");
        });
    }

    // Function to handle delete button click
    function handleDeleteButtonClick(courseId, uidToDelete) {
      if (confirm("Are you sure you want to delete this user from the course?")) {
        deleteUserFromCourse(courseId, uidToDelete);
      }
    }

    // Function to retrieve course data and populate the course table
    coursesRef.on('value', function (snapshot) {
      const courseTable = document.getElementById('courseTable').getElementsByTagName('tbody')[0];
      courseTable.innerHTML = ''; // Clear existing table rows

      snapshot.forEach(function (childSnapshot) {
        const courseId = childSnapshot.key;
        const usersWithAccess = Object.keys(childSnapshot.val() || {});

        let rowspan = usersWithAccess.length > 0 ? usersWithAccess.length : 1;

        usersWithAccess.forEach(function (uid, index) {
          // Create a new table row for each user in the course
          const newRow = document.createElement('tr');
          usersRef.child(uid).once('value').then(function(userSnapshot) {
            const userData = userSnapshot.val();
            const fullName = userData.fullName;

            if (index === 0) {
              newRow.innerHTML = `
                <td rowspan="${rowspan}">${courseId}</td>
                <td>${fullName}</td>
                <td>
                  <button class="details" onclick="showUserDetails('${uid}')">Details</button>
                </td>
                <td>
                  <button class="delete" onclick="handleDeleteButtonClick('${courseId}', '${uid}')">Delete</button>
                </td>
              `;
            } else {
              newRow.innerHTML = `
                <td>${fullName}</td>
                <td>
                  <button class="details" onclick="showUserDetails('${uid}')">Details</button>
                </td>
                <td>
                  <button class="delete" onclick="handleDeleteButtonClick('${courseId}', '${uid}')">Delete</button>
                </td>
              `;
            }
            courseTable.appendChild(newRow);
          });
        });
      });
    });

    // Function to add a user to a course
    function addUserToCourse(courseId, uid, fullName, email) {
      coursesRef.child(courseId).child(uid).set(true)
        .then(() => {
          alert(`User ${fullName} (${email}) added to course successfully!`);
        })
        .catch(error => {
          console.error("Error adding user to course: ", error);
          alert("Error adding user to course. Please try again.");
        });
    }

    // Form submission handler
    document.getElementById('courseForm').addEventListener('submit', function (e) {
      e.preventDefault();

      const courseId = document.getElementById('courseIdInput').value;
      const emails = document.getElementById('addUsers').value.split(',').map(email => email.trim());

      emails.forEach(function (email) {
        usersRef.orderByChild('email').equalTo(email).once('value', function (snapshot) {
          if (snapshot.exists()) {
            snapshot.forEach(function (childSnapshot) {
              const uid = childSnapshot.key;
              const userData = childSnapshot.val();
              const fullName = userData.fullName;
              addUserToCourse(courseId, uid, fullName, email);
            });
          } else {
            alert(`User with email ${email} not found.`);
          }
        });
      });
    });

    // Function to show user details in the console
    function showUserDetails(uid) {
      usersRef.child(uid).once('value').then(function (snapshot) {
        const userData = snapshot.val();
        if (userData) {
          console.log("User Details:", userData);
          alert("User Details: \nFull Name: " + userData.fullName + "\nEmail: " + userData.email + "\nClass: " + userData.class + "\nContact Number: " + userData.contactNumber);
        } else {
          alert("User not found.");
        }
      }).catch(function (error) {
        console.error("Error retrieving user details:", error);
        alert("Error retrieving user details. Please try again.");
      });
    }

    // Function to download table data as Excel file
    document.getElementById('downloadExcelBtn').addEventListener('click', function () {
      const table = document.getElementById('courseTable');
      const rows = Array.from(table.querySelectorAll('tr'));
      const csvData = [];

      // Extract table headers
      const headers = Array.from(rows.shift().querySelectorAll('th')).map(header => header.innerText);
      csvData.push(headers.join(','));

      // Extract table rows
      rows.forEach(row => {
        const rowData = Array.from(row.querySelectorAll('td')).map(cell => cell.innerText);
        csvData.push(rowData.join(','));
      });

      // Convert CSV data to a Blob
      const csvBlob = new Blob([csvData.join('\n')], { type: 'text/csv' });

      // Create a temporary download link and trigger the download
      const tempLink = document.createElement('a');
      tempLink.href = URL.createObjectURL(csvBlob);
      tempLink.download = 'course_data.csv';
      document.body.appendChild(tempLink);
      tempLink.click();
      document.body.removeChild(tempLink);
    });

  </script>
 <script>
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.register('/service-worker.js')
            .then((registration) => {
              console.log('Service Worker registered with scope:', registration.scope);
            })
            .catch((error) => {
              console.error('Service Worker registration failed:', error);
            });
        }
      </script>
   <script src="js/gt.min.js" data-gt-widget-id="43217984"></script>
</body>


</html>
