<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Post a Job | Find Jobs in Finland</title>
  <style>
    input[readonly] { background:#f3f3f3; cursor:text; }
  </style>
</head>
<body>
  <h1>Post a New Job</h1>

  <form id="jobForm">
    <!-- ‚Äë‚Äë Basic job details ‚Äë‚Äë -->
    <label>Job‚ÄØTitle<br><input type="text" id="jobTitle" required></label><br><br>
    <label>Job‚ÄØDescription<br><textarea id="jobDescription" required></textarea></label><br><br>

    <label>Job‚ÄØCategory<br>
      <select id="jobCategory" required>
        <option value="it-tech">IT¬†&¬†Tech</option>
        <option value="engineering">Engineering</option>
        <option value="nursing">Nursing</option>
        <option value="construction-labor">Construction¬†&¬†Labor</option>
        <option value="cleaning">Cleaning</option>
      </select>
    </label><br><br>

    <label>Job‚ÄØLocation<br>
      <select id="jobLocation" required>
        <option value="helsinki">Helsinki</option>
        <option value="espoo">Espoo</option>
        <option value="vantaa">Vantaa</option>
        <option value="tampere">Tampere</option>
        <option value="turku">Turku</option>
      </select>
    </label><br><br>

    <!-- ‚Äë‚Äë Image upload & URL preview ‚Äë‚Äë -->
    <label>Job‚ÄØImage<br>
      <input type="file" id="jobImage" accept="image/*">
    </label><br><br>

    <!-- Read‚Äëonly field that will contain the download URL -->
    <label>Image‚ÄØURL (auto‚Äëfilled after upload)<br>
      <input type="text" id="imageUrlField" readonly>
    </label><br><br>

    <button type="submit">Post‚ÄØJob</button>
  </form>

  <!-- Firebase v10 Modular SDK -->
  <script type="module">
    import { initializeApp }                       from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, addDoc,
             serverTimestamp }                     from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
    import { getStorage, ref, uploadBytes,
             getDownloadURL }                      from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

    /* ==== 1. initialise Firebase ================================================= */
    const firebaseConfig = {
      apiKey:            "AIzaSyAstAXkwifJ-ukfZKSXiLG_l9iNwg4tPw4",
      authDomain:        "findjobsinfinland-3c061.firebaseapp.com",
      projectId:         "findjobsinfinland-3c061",
      storageBucket:     "findjobsinfinland-3c061.appspot.com",
      messagingSenderId: "575437446165",
      appId:             "1:575437446165:web:51922bc01fd291b09b821c"
    };

    const app     = initializeApp(firebaseConfig);
    const db      = getFirestore(app);
    const storage = getStorage(app);

    /* ==== 2. form submit handler ================================================== */
    document.getElementById("jobForm").addEventListener("submit", async e => {
      e.preventDefault();

      /* ‚Üí Grab core field values */
      const title       = document.getElementById("jobTitle").value.trim();
      const description = document.getElementById("jobDescription").value.trim();
      const category    = document.getElementById("jobCategory").value;
      const location    = document.getElementById("jobLocation").value;
      const file        = document.getElementById("jobImage").files[0];

      let imageURL = "";

      /* ‚Üí If an image was chosen, upload it first */
      if (file) {
        try {
          const path     = `jobImages/${Date.now()}_${file.name}`;
          const imageRef = ref(storage, path);
          await uploadBytes(imageRef, file);             // upload
          imageURL = await getDownloadURL(imageRef);     // grab URL

          /* Show the URL to the user */
          document.getElementById("imageUrlField").value = imageURL;
        }
        catch (err) {
          console.error("Image upload failed:", err);
          alert("Image upload failed ‚Äî please try again.");
          return; // stop, don‚Äôt write half‚Äëcomplete record
        }
      }

      /* ‚Üí Build job object & send to Firestore */
      try {
        await addDoc(collection(db, "jobs"), {
          title,
          description,
          category,
          location,
          image: imageURL,           // üîë saved as ‚Äúimage‚Äù
          createdAt: serverTimestamp()
        });

        alert("Job posted successfully!");
        e.target.reset();                         // clear form
        document.getElementById("imageUrlField").value = ""; // clear URL box
      }
      catch (err) {
        console.error("Failed to save job:", err);
        alert("Error saving job to Firestore.");
      }
    });
  </script>
</body>
</html>

